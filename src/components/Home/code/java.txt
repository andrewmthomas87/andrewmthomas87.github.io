<pre class='code'><span class='p'>@Override</span><br /><span class='p'>public void</span> <span class='b'>onMessage</span><span class='lb'>( <span class='p'>WebSocket</span> <span class='b'>socket</span>, <span class='p'>String</span> <span class='b'>text</span> )</span><br /><span class='lb'>{</span><br />    <span class='lb'>try</span><br />    <span class='lb'>{</span><br />        <span class='p'>LMessage</span> message <span class='p'>=</span> <span class='lb'>new <span class='b'>LMessage</span>( <span class='b'>text</span> );</span><br /><br />        <span class='lb'>if (</span> sLogger<span class='lb'>.<span class='b'>isDebugEnabled</span>() )</span><br />        <span class='lb'>{</span><br />            sLogger<span class='lb'>.<span class='b'>debug</span>( "<span class='g'>Message received from {} to {}.</span>",</span> fClientId<span class='lb'>,</span> message<span class='lb'>.<span class='b'>getRoute</span>() );</span><br />        <span class='lb'>}</span><br /><br />        <span class='p'>String</span> internalCorrelationId <span class='p'>=</span> LCommonHelpers<span class='lb'>.<span class='b'>getRandomBytesString</span>( <span class='o'>32</span> );</span><br />        <span class='lb'>if (</span> message<span class='lb'>.<span class='b'>containsProperty</span>( "<span class='g'>correlationId</span>" ) )</span><br />        <span class='lb'>{</span><br />            fCorrelator<span class='lb'>.<span class='b'>put</span>(</span> internalCorrelationId<span class='lb'>,</span> message<span class='lb'>.<span class='b'>getProperty</span>( "<span class='g'>correlationId</span>" ) );</span><br />        <span class='lb'>}</span><br /><br />        sMessageBroker<span class='lb'>.<span class='b'>request</span>( "<span class='g'>lhr.service.HttpServer</span>",</span> message<span class='lb'>.<span class='b'>getRoute</span>(),</span> internalCorrelationId<span class='lb'>,</span> message<span class='lb'>.<span class='b'>getBody</span>(),</span> fHeaders<span class='lb'>, <span class='r'>this</span> );</span><br /></pre>
